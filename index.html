<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    
    <title>Nodegame Iteration Two</title>

    <script src="./client/messagebroker.js" type="text/javascript"></script>
    <script src="./client/messagehandler.js" type="text/javascript"></script>
    <script src="./common/messages.js" type="text/javascript"></script>

    <script src="./client/sha-hash.js" type="text/javascript"></script>

    <!-- Pass the websocketURI to the client -->
    <script src="/websocketURI.js"></script>

    <script type="text/javascript">
      function initNodegame() {
        // TODO: Improve game init in the near future
        var messageBroker = new MessageBroker();
        var messageHandler = new MessageHandler();
      }

      function logout(){
        //harsh way to logout (reloads page)
        location.reload();
      }

      function login(){
        //check user input fields
        if(document.getElementById("username").value && document.getElementById("password").value){
          //send login req
          var msg = messages.message.LOGIN_REQUEST.new();
          msg.username = document.getElementById("username").value;
          msg.passwordhash = Sha1.hash(document.getElementById("password").value);
          messageHandler.send(msg);
          messageHandler.username = msg.username;
        }
      }

      function register(){
        //check user input fields
        if(document.getElementById("username").value && document.getElementById("password").value){
          //send registration req
          var msg = messages.message.REGISTRATION_REQUEST.new();
          msg.username = document.getElementById("username").value;
          msg.passwordhash = Sha1.hash(document.getElementById("password").value);
        }
      }
    </script>
  </head>

  <body onload="initNodegame()">
    <div id="container">
      <div id="login">
        <div id="loginwindow">
          <legend><strong>Login</strong></legend>
          <fieldset>
            <div id="infotext">
              <p>
                Player: <input type="text" id="username" length="10">
                Password: <input type="password" id="password" length="20">
                <input id="login_button" type="submit" value="Login" onclick="login()">
                <input id="register_button" type="submit" value="Register" onclick="register()">
              </p>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
    <div id="system-messages">
      System messages appear here!
    </div>
  </body>
</html>